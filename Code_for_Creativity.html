<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dictation 1</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .sentence-box { margin-bottom: 20px; }
    .controls { margin-bottom: 20px; }
    textarea { width: 100%; height: 60px; font-size: 16px; }
    .hidden { display: none; }
    button { margin-right: 10px; }
    .status { font-weight: bold; margin-top: 10px; }
    .answer { color: green; margin-top: 5px; }
    .translation { background: #f1f1f1; padding: 10px; margin-top: 10px; border-left: 5px solid #4CAF50; display: none; }
  </style>
</head>
<body>
  <h1>Dictation 1</h1>
  <div id="status">Sentence <span id="current-sentence">1</span> / <span id="total-sentences">4</span></div>
  <div class="controls">
    <button onclick="playSentence()">üîà</button>
    <button onclick="pauseAudio()">‚è∏Ô∏è</button>
  </div>

  <div class="sentence-box">
    <textarea id="userInput" placeholder="Type what you hear..."></textarea>
    <div class="status" id="feedback"></div>
    <div class="answer hidden" id="answer"></div>
    <div class="translation" id="translation"></div>
  </div>

  <button onclick="checkAnswer()">‚úÖ Check</button>
  <button onclick="nextSentence()">‚û°Ô∏è Next</button>

  <script>
    const sentences = [
      "Once upon a time, there was a small white rabbit.",
      "The rabbit lived in a big green forest.",
      "Every day, it ate fresh carrots and drank clean water from a river.",
      "One day, the rabbit found a lost baby bird.",
      "The rabbit helped the bird find its mother.",
      "They became good friends.",
      "From that day, the rabbit and the bird played together happily in the forest every day."
    ];

    const translations = [
      "Ng√†y x·ª≠a ng√†y x∆∞a, c√≥ m·ªôt con th·ªè tr·∫Øng nh·ªè.",
      "Con th·ªè s·ªëng trong m·ªôt khu r·ª´ng xanh r·ªông l·ªõn.",
      "M·ªói ng√†y, n√≥ ƒÉn c√† r·ªët t∆∞∆°i v√† u·ªëng n∆∞·ªõc s·∫°ch t·ª´ con s√¥ng.",
      "M·ªôt ng√†y, con th·ªè t√¨m th·∫•y m·ªôt ch√∫ chim non b·ªã l·∫°c.",
      "Con th·ªè gi√∫p ch√∫ chim t√¨m m·∫π c·ªßa n√≥.",
      "H·ªç tr·ªü th√†nh b·∫°n t·ªët c·ªßa nhau.",
      "T·ª´ ng√†y ƒë√≥, con th·ªè v√† ch√∫ chim ch∆°i v·ªõi nhau vui v·∫ª trong r·ª´ng m·ªói ng√†y."
    ];

    let currentIndex = 0;
    let utterance = null;
    let voices = [];

    speechSynthesis.onvoiceschanged = () => {
      voices = speechSynthesis.getVoices();
    };

    document.getElementById("total-sentences").textContent = sentences.length;

    function playSentence() {
      utterance = new SpeechSynthesisUtterance(sentences[currentIndex]);
      utterance.lang = 'en-US';

      const maleVoice = voices.find(voice =>
        voice.lang.startsWith('en') && voice.name.toLowerCase().includes('male')
      ) || voices.find(voice =>
        voice.lang.startsWith('en') && voice.name.toLowerCase().includes('english')
      );

      if (maleVoice) {
        utterance.voice = maleVoice;
      }

      speechSynthesis.speak(utterance);
    }

    function replaySentence() {
      pauseAudio();
      playSentence();
    }

    function pauseAudio() {
      speechSynthesis.cancel();
    }

    function checkAnswer() {
      const input = document.getElementById("userInput").value.trim();
      const original = sentences[currentIndex];
      const feedback = document.getElementById("feedback");
      const answerBox = document.getElementById("answer");
      const translationBox = document.getElementById("translation");

      const inputWords = input.split(/\s+/);
      const originalWords = original.split(/\s+/);

      let correctUpTo = 0;
      for (let i = 0; i < inputWords.length && i < originalWords.length; i++) {
        if (inputWords[i].toLowerCase() === originalWords[i].toLowerCase()) {
          correctUpTo++;
        } else {
          break;
        }
      }

      if (correctUpTo === originalWords.length) {
        feedback.textContent = "‚úÖ Correct!";
        feedback.style.color = "green";
        answerBox.classList.add("hidden");
        translationBox.style.display = "block";
        translationBox.textContent = translations[currentIndex];
      } else {
        feedback.textContent = "‚ùå Incorrect.";
        feedback.style.color = "red";
        const hintWord = originalWords[correctUpTo] || "(no more words)";
        answerBox.textContent = "So far correct: " + originalWords.slice(0, correctUpTo).join(" ") + "... Next word hint: '" + hintWord + "'";
        answerBox.classList.remove("hidden");
        translationBox.style.display = "none";
      }
    }

    function nextSentence() {
      if (currentIndex < sentences.length - 1) {
        currentIndex++;
        updateUI();
      } else {
        alert("üéâ You've finished all the sentences!");
      }
    }

    function updateUI() {
      document.getElementById("current-sentence").textContent = currentIndex + 1;
      document.getElementById("userInput").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer").textContent = "";
      document.getElementById("answer").classList.add("hidden");
      document.getElementById("translation").style.display = "none";
      document.getElementById("translation").textContent = "";
    }
  </script>
</body>
</html>
